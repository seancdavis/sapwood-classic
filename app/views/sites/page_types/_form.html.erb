<%= simple_form_for(@page_type, :url => [current_site, @page_type]) do |f| %>

  <%= form_tabs ['details'] + @groups.collect(&:slug) + ['new-group'] %>

  <section class="form tabbed details">
    <div class="half-row">
      <%= f.input :title %>
      <%= f.input :slug, :label => 'URL' %>
    </div>
    <%= f.input :description %>
    <%= f.input :delete_group, :as => :hidden %>
    <div class="half-row">
      <%= f.input :icon %>
      <%= f.input :template %>
    </div>
  </section>

  <%= f.simple_fields_for :groups, 
    (@groups + [PageTypeFieldGroup.new]) do |group| %>
    <section class="tabbed <%= group.object.title.nil? ? 'new-group' : 
      group.object.slug %>">
      <h3>Details</h3>
      <hr>
      <%= link_to 'Delete Group', '#', :class => 'delete', :data => { 
        :group => group.object.slug } unless group.object.title.nil? %>
      <div class="half-row">
        <%= group.input :title %>
        <%= group.input :position %>
      </div>
      <% unless group.object.title.nil? %>
        <h3>Fields</h3>
        <%= group.simple_fields_for :fields, 
          (group.object.fields + [PageTypeField.new]) do |field| %>
          <hr>
          <div class="field">
            <div class="half-row">
              <%= field.input :title %>
              <%= field.input :data_type, :collection => page_type_field_options, 
                :input_html => { :class => 'field-data-type' } %>
            </div>
            <%= field.input :options, :wrapper_html => { 
              :class => 'field-options' } %>
            <div class="half-row">
              <%= field.input :position %>
              <%= field.input :required %>
            </div>
          </div>
        <% end %>
      <% end %>
    </section>
  <% end %>

  <%= f.submit %>
<% end %>
